[[local|localrc]]

VERBOSE=True
RECLONE=False
OFFLINE=False
ENABLE_DEBUG_LOG_LEVEL=True
GIT_BASE=https://opendev.org
HOST_IP={{ ansible_eth0.ipv4.address }}
USE_PYTHON3=True

disable_all_services

enable_service rabbit,mysql,key
enable_service n-api,n-cpu,n-cond,n-sch,n-novnc,n-cauth,n-api-meta
enable_service placement-api,placement-client
enable_service g-api,g-reg
enable_service q-svc
enable_service q-agt,q-dhcp,q-l3,q-meta
enable_service q-dns
enable_service q-qos
enable_service tempest

enable_plugin neutron $GIT_BASE/openstack/neutron

PUBLIC_NETWORK_GATEWAY=172.24.4.1

enable_service ovn-northd
enable_service ovn-controller
enable_service q-ovn-metadata-agent
enable_service q-trunk
disable_service q-agt,q-dhcp,q-l3,q-meta

#enable_plugin heat $GIT_BASE/openstack/heat
#enable_service h-eng h-api h-api-cfn h-api-cw
enable_service horizon
# enable_service c-sch,c-api,c-vol

### Octavia
enable_plugin octavia $GIT_BASE/openstack/octavia master
enable_plugin barbican $GIT_BASE/openstack/barbican
enable_plugin octavia-dashboard $GIT_BASE/openstack/octavia-dashboard
OCTAVIA_LIB_BRANCH=master
OCTAVIA_LIB_REPO=$GIT_BASE/openstack/octavia-lib
LIBS_FROM_GIT+=octavia-lib,

enable_service octavia
enable_service o-api
enable_service o-cw
enable_service o-hm
enable_service o-hk
enable_service o-da

enable_plugin ovn-octavia-provider $GIT_BASE/openstack/ovn-octavia-provider

enable_plugin octavia-tempest-plugin $GIT_BASE/openstack/octavia-tempest-plugin

LIBS_FROM_GIT+=python-octaviaclient,octavia-tempest-plugin,designate-tempest-plugin
TEMPEST_PLUGINS='/opt/stack/octavia-tempest-plugin /opt/stack/barbican-tempest-plugin /opt/stack/designate-tempest-plugin'

OCTAVIA_AMP_BASE_OS=centos
OCTAVIA_AMP_DISTRIBUTION_RELEASE_ID=8-stream
OCTAVIA_AMP_IMAGE_SIZE=3
OCTAVIA_LB_TOPOLOGY=ACTIVE_STANDBY

OCTAVIA_ENABLE_AMPHORAV2_JOBBOARD=True

# Mostly static settings
DATABASE_PASSWORD=password
ADMIN_PASSWORD=password
SERVICE_PASSWORD=password
SERVICE_TOKEN=password
RABBIT_PASSWORD=password

[[post-config|$OCTAVIA_CONF]]
[haproxy_amphora]
connection_max_retries = 300
connection_retry_interval = 1

[amphora_agent]
forward_all_logs = True

[[test-config|$TEMPEST_CONFIG]]
[load_balancer]
check_interval = 1
check_timeout = 180
